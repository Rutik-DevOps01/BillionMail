"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["9767"],{55855:function(e,a,t){t.d(a,{Gk:()=>u,Q5:()=>p,Xr:()=>m,ZS:()=>d,_5:()=>o,gI:()=>n,jC:()=>k,ke:()=>_,mQ:()=>r,oS:()=>v,xJ:()=>c});var l=t(76882),s=t(34541);let{t:i}=l.ag.global;function d(e){return s.e.get("/batch_mail/task/list",{params:e})}function u(e){return s.e.get("/batch_mail/task/stat_chart",{params:e})}function r(e){return s.e.get("/batch_mail/task/find",{params:e})}function n(e){return s.e.post("/batch_mail/task/create",e,{fetchOptions:{loading:i("market.task.loading.creating"),successMessage:!0}})}function c(e){return s.e.post("/batch_mail/task/update",e,{fetchOptions:{loading:i("market.task.loading.updating"),successMessage:!0}})}function o(e){return s.e.post("/batch_mail/task/delete",e,{fetchOptions:{loading:i("market.task.loading.deleting"),successMessage:!0}})}function m(e){return s.e.post("/batch_mail/task/pause",e,{fetchOptions:{loading:i("market.task.loading.pausing"),successMessage:!0}})}function p(e){return s.e.post("/batch_mail/task/resume",e,{fetchOptions:{loading:i("market.task.loading.resuming"),successMessage:!0}})}function k(e){return s.e.post("/batch_mail/task/send_test",e,{fetchOptions:{loading:i("market.task.loading.sendingTest"),successMessage:!0}})}function _(e){return s.e.get("/batch_mail/tracking/mail_provider",{params:e})}function v(e){return s.e.get("/batch_mail/tracking/logs",{params:e})}},43458:function(e,a,t){t.d(a,{CZ:()=>d,Lp:()=>n,Pn:()=>r,Rc:()=>c,kV:()=>i,ln:()=>u});var l=t(34541);let{t:s}=t(76882).ag.global,i=e=>l.e.get("/tags/list",{params:e}),d=e=>l.e.get("/tags/all",{params:e}),u=e=>l.e.post("/tags/create",e,{fetchOptions:{loading:s("contacts.tags.loading.creating"),successMessage:!0}}),r=e=>l.e.post("/tags/delete",e,{fetchOptions:{loading:s("contacts.tags.loading.deleting"),successMessage:!0}}),n=e=>l.e.post("/tags/update",e,{fetchOptions:{loading:s("contacts.tags.loading.updating"),successMessage:!0}}),c=e=>l.e.post("/tags/batch_contacts",e,{fetchOptions:{loading:s("contacts.tags.loading.bulkSetting"),successMessage:!0}})},66142:function(e,a,t){t.r(a),t.d(a,{default:()=>et});var l=t(53472),s=t(46244),i=t(17977),d=t(57869),u=t(29283),r=t(16715),n=t(2352),c=t(29875),o=t(15496),m=t(81833),p=t(37864),k=t(8490),_=t(73084),v=t(6455),g=t(66236),b=t(70958),f=t(58786),w=t(31708),U=t(94821),h=t(68271),S=t(84075),W=t(55855),y=t(19664),x=t(45223),j=t(43458),Z=t(65965);let $={class:"ml-12px"},z=(0,f.aZ)({__name:"TagSelect",props:(0,f.Vf)({groupId:{type:Number,default:null},disabled:{type:Boolean,default:!1}},{value:{default:()=>[]},valueModifiers:{}}),emits:["update:value"],setup(e){let a=(0,f.tT)(e,"value"),t=(0,Z.tv)(),l=(0,f.iH)([]),s=(0,f.Fl)(()=>l.value.filter(a=>a.group_id===e.groupId).map(e=>({value:e.id,label:e.name}))),i=async()=>{let e=await (0,j.CZ)({});(0,h.Kn)(e)&&(l.value=e.list)},d=()=>{t.push("/contacts/tags")};return(0,f.YP)(()=>e.groupId,()=>{a.value=[]}),i(),(t,l)=>{let i=k.Z,u=o.ZP;return(0,f.wg)(),(0,f.iD)(f.HY,null,[(0,f.Wm)(i,{value:a.value,"onUpdate:value":l[0]||(l[0]=e=>a.value=e),options:(0,f.SU)(s),disabled:e.disabled,multiple:!0,filterable:!0,"max-tag-count":"responsive"},null,8,["value","options","disabled"]),(0,f._)("div",$,[(0,f.Wm)(u,{text:"",type:"primary",onClick:d},{default:(0,f.w5)(()=>[(0,f.Uk)((0,f.zw)(t.$t("common.actions.create")),1)]),_:1})])],64)}}});var q=t(28444),C=t(52495);let R={class:"task-edit-container"},O={class:"flex flex-col flex-1 p-24px overflow-auto"},T={class:"flex-1"},N={class:"flex items-center"},P={class:"flex-1"},H={class:"ml-12px text-desc"},M={class:"w-60px"},E={class:"flex-1 mr-10px"},D={class:"task-preview"},I={class:"preview-header"},A={class:"preview-header-item"},L={class:"preview-label"},Q={class:"preview-value"},K={class:"preview-header-item"},Y={class:"preview-label"},B={class:"preview-value"},F={class:"preview-header-item"},G={class:"preview-label"},J={class:"preview-value"},V={class:"preview-content"},X={key:1,class:"empty-preview"},ee={class:"action-buttons"},ea=(0,f.aZ)({__name:"edit",setup(e){let{t:a}=(0,C.QT)(),t=(0,Z.yj)(),j=(0,Z.tv)(),$=(0,w.s6)(),ea=(0,f.AE)("formRef"),et=(0,f.AE)("formContentRef"),{height:el}=(0,U.rBN)(et),es=(0,f.iH)(!1),ei=(0,f.iH)(0),ed=(0,f.qj)({addresser:null,full_name:"",subject:"",group_id:null,template_id:null,is_record:1,unsubscribe:1,warmup:0,threads:0,start_time:null,remark:"",tag_ids:[],tag_logic:"OR",track_click:1,track_open:1}),eu=[{label:"OR",value:"OR"},{label:"AND",value:"AND"},{label:"NOT",value:"NOT"}],er={full_name:{trigger:["blur","input"],validator:()=>""!==ed.full_name||Error(a("market.task.edit.validation.displayNameRequired"))},subject:{trigger:["blur","input"],validator:()=>""!==ed.subject||Error(a("market.task.edit.validation.subjectRequired"))},group_ids:{trigger:"change",validator:()=>!!ed.group_id||Error(a("market.task.edit.validation.recipientsRequired"))},template_id:{trigger:"change",validator:()=>null!==ed.template_id||Error(a("market.task.edit.validation.templateRequired"))},start_time:{validator:()=>1!==em.value||null!==ed.start_time||Error(a("market.task.edit.validation.sendTimeRequired"))}},en=(0,f.iH)(""),ec=(0,f.iH)(0),eo=(0,f.iH)(0),em=(0,f.iH)(0),ep=(0,f.iH)(""),ek=(0,f.iH)(""),e_=()=>{j.push("/template")},ev=e=>{0===e?ed.threads=0:ed.threads=5},eg=()=>{0===em.value&&(ed.start_time=null)},eb=async()=>ep.value?ed.subject?ed.template_id?void await (0,W.jC)({addresser:ed.addresser||"",subject:ed.subject,recipient:ep.value,template_id:ed.template_id||0}):void h.v0.error(a("market.task.edit.validation.templateRequired")):void h.v0.error(a("market.task.edit.validation.subjectRequired")):void h.v0.error(a("market.task.edit.validation.testEmailRequired")),ef=()=>{ed.subject||ed.group_id?(0,h.iG)({title:a("market.task.edit.discard.title"),content:a("market.task.edit.discard.content"),onConfirm:()=>{j.go(-1)}}):j.go(-1)},ew=async()=>{if(!ed.group_id){ec.value=0;return}let e=await (0,S.Z2)({group_id:ed.group_id||0,tag_ids:ed.tag_ids,tag_logic:ed.tag_logic});(0,h.Kn)(e)&&(ec.value=e.total)},eU=()=>{let e=ed.start_time;return(0===em.value||null===e)&&(e=Date.now()),{track_open:ed.track_open,track_click:ed.track_click,addresser:ed.addresser||"",full_name:ed.full_name,subject:ed.subject,group_id:ed.group_id||0,template_id:ed.template_id||0,is_record:ed.is_record,unsubscribe:ed.unsubscribe,warmup:ed.warmup,threads:ed.threads,start_time:e/1e3,remark:ed.remark,tag_ids:ed.tag_ids,tag_logic:ed.tag_logic}},eh=async()=>{var e;await (null==(e=ea.value)?void 0:e.validate()),es.value?await (0,W.xJ)({task_id:ei.value,...eU()}):await (0,W.gI)(eU()),j.push("/market/task")};function eS(e){if(t.query.chat_id){let a=e.find(e=>e.chat_id==t.query.chat_id);a&&(ed.template_id=a.id,ed.subject=$.temp_subject,ek.value=a.html_content)}}return(async()=>{let{task_id:e,type:a}=t.query;if("edit"===a?(ei.value=Number(e),es.value=!0):(ei.value=0,es.value=!1),!e)return;let l=await (0,W.mQ)({id:Number(e)});(0,h.Kn)(l)&&(ed.addresser=l.addresser,ed.full_name=l.full_name,ed.subject=l.subject,ed.group_id=l.group_id,ed.template_id=l.template_id,ed.is_record=l.is_record,ed.unsubscribe=l.unsubscribe,ed.threads=l.threads,eo.value=+(0!==l.threads),ed.remark=l.remark,ed.tag_logic=l.tag_logic,ed.track_open=l.track_open,ed.track_click=l.track_click,(0,f.Y3)(()=>{ed.tag_ids=l.tag_ids}))})(),(e,t)=>{let w=(0,f.up)("router-link"),U=b.Z,h=g.ZP,S=v.ZP,W=_.Z,j=(0,f.up)("i18n-t"),Z=k.Z,$=p.ZP,C=m.Z,ei=o.ZP,eU=c.Z,eW=n.Z,ey=r.Z,ex=u.Z,ej=d.ZP,eZ=i.Z,e$=s.Z,ez=l.Z;return(0,f.wg)(),(0,f.iD)("div",R,[(0,f._)("div",O,[(0,f.Wm)(h,{class:"mb-20px"},{default:(0,f.w5)(()=>[(0,f.Wm)(U,null,{default:(0,f.w5)(()=>[(0,f.Wm)(w,{to:"/market/task"},{default:(0,f.w5)(()=>[(0,f.Uk)((0,f.zw)(e.$t("market.task.title")),1)]),_:1})]),_:1}),(0,f.Wm)(U,null,{default:(0,f.w5)(()=>[(0,f.Uk)((0,f.zw)((0,f.SU)(es)?e.$t("market.task.edit.editTitle"):e.$t("market.task.edit.addTitle")),1)]),_:1})]),_:1}),(0,f._)("div",{class:"task-edit-box",style:(0,f.j5)({minHeight:(0,f.SU)(el)+"px"})},[(0,f.Wm)(e$,{ref_key:"formRef",ref:ea,class:"task-edit-form",model:(0,f.SU)(ed),rules:er},{default:(0,f.w5)(()=>[(0,f._)("div",{ref_key:"formContentRef",ref:et},[(0,f.Wm)(ej,{class:"mb-24px"},{default:(0,f.w5)(()=>[(0,f.Wm)(S,{label:e.$t("market.task.edit.from")},{default:(0,f.w5)(()=>[(0,f.Wm)(y.Z,{value:(0,f.SU)(ed).addresser,"onUpdate:value":t[0]||(t[0]=e=>(0,f.SU)(ed).addresser=e),name:(0,f.SU)(ed).full_name,"onUpdate:name":t[1]||(t[1]=e=>(0,f.SU)(ed).full_name=e)},null,8,["value","name"])]),_:1},8,["label"]),(0,f.Wm)(S,{label:e.$t("market.task.edit.displayName"),path:"full_name"},{default:(0,f.w5)(()=>[(0,f.Wm)(W,{value:(0,f.SU)(ed).full_name,"onUpdate:value":t[2]||(t[2]=e=>(0,f.SU)(ed).full_name=e),placeholder:e.$t("market.task.edit.displayNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),(0,f.Wm)(S,{label:e.$t("market.task.edit.subject"),path:"subject"},{default:(0,f.w5)(()=>[(0,f.Wm)(W,{value:(0,f.SU)(ed).subject,"onUpdate:value":t[3]||(t[3]=e=>(0,f.SU)(ed).subject=e),placeholder:e.$t("market.task.edit.subjectPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),(0,f.Wm)(S,{label:e.$t("market.task.edit.recipients"),type:"group_ids"},{default:(0,f.w5)(()=>[(0,f._)("div",T,[(0,f._)("div",N,[(0,f.Wm)(x.Z,{value:(0,f.SU)(ed).group_id,"onUpdate:value":t[4]||(t[4]=e=>(0,f.SU)(ed).group_id=e),label:(0,f.SU)(en),"onUpdate:label":t[5]||(t[5]=e=>(0,f.dq)(en)?en.value=e:null),disabled:(0,f.SU)(es)},null,8,["value","label","disabled"])]),(0,f.Wm)(j,{class:"mt-8px",tag:"div",scope:"global",keypath:"market.task.edit.recipientsCount"},{count:(0,f.w5)(()=>[(0,f._)("b",null,(0,f.zw)((0,f.SU)(ec)),1)]),_:1})])]),_:1},8,["label"]),(0,f.Wm)(C,{cols:24,"x-gap":24},{default:(0,f.w5)(()=>[(0,f.Wm)($,{span:6,label:e.$t("market.task.edit.tagLogic"),path:"tag_logic"},{default:(0,f.w5)(()=>[(0,f.Wm)(Z,{value:(0,f.SU)(ed).tag_logic,"onUpdate:value":[t[6]||(t[6]=e=>(0,f.SU)(ed).tag_logic=e),t[7]||(t[7]=()=>ew())],options:eu,disabled:(0,f.SU)(es)},null,8,["value","disabled"])]),_:1},8,["label"]),(0,f.Wm)($,{span:18,label:e.$t("market.task.edit.tags"),path:"tag_ids"},{default:(0,f.w5)(()=>[(0,f.Wm)(z,{value:(0,f.SU)(ed).tag_ids,"onUpdate:value":[t[8]||(t[8]=e=>(0,f.SU)(ed).tag_ids=e),t[9]||(t[9]=()=>ew())],"group-id":(0,f.SU)(ed).group_id,disabled:(0,f.SU)(es)},null,8,["value","group-id","disabled"])]),_:1},8,["label"])]),_:1}),(0,f.Wm)(S,{label:e.$t("market.task.edit.template"),path:"template_id"},{default:(0,f.w5)(()=>[(0,f._)("div",P,[(0,f.Wm)(q.Z,{value:(0,f.SU)(ed).template_id,"onUpdate:value":t[10]||(t[10]=e=>(0,f.SU)(ed).template_id=e),content:(0,f.SU)(ek),"onUpdate:content":t[11]||(t[11]=e=>(0,f.dq)(ek)?ek.value=e:null),onListReady:eS},null,8,["value","content"])]),(0,f.Wm)(ei,{text:"",type:"primary",class:"ml-12px",onClick:e_},{default:(0,f.w5)(()=>[(0,f.Uk)((0,f.zw)((0,f.SU)(a)("common.actions.create")),1)]),_:1})]),_:1},8,["label"]),(0,f.kq)("",!0),(0,f.Wm)(C,{cols:24,"x-gap":16},{default:(0,f.w5)(()=>[(0,f.Wm)($,{span:12,label:(0,f.SU)(a)("market.task.edit.ipWarmup")},{default:(0,f.w5)(()=>[(0,f.Wm)(eU,{value:(0,f.SU)(ed).warmup,"onUpdate:value":t[13]||(t[13]=e=>(0,f.SU)(ed).warmup=e),"checked-value":1,"unchecked-value":0},null,8,["value"]),(0,f._)("span",H,(0,f.zw)((0,f.SU)(a)("market.task.edit.ipWarmupTip")),1)]),_:1},8,["label"]),(0,f.Wm)($,{span:12,label:e.$t("market.task.edit.unsubscribeLink")},{default:(0,f.w5)(()=>[(0,f.Wm)(eU,{value:(0,f.SU)(ed).unsubscribe,"onUpdate:value":t[14]||(t[14]=e=>(0,f.SU)(ed).unsubscribe=e),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1},8,["label"]),(0,f.Wm)($,{span:12,label:(0,f.SU)(a)("market.task.edit.trackClick"),path:"track_click"},{default:(0,f.w5)(()=>[(0,f.Wm)(eU,{value:(0,f.SU)(ed).track_click,"onUpdate:value":t[15]||(t[15]=e=>(0,f.SU)(ed).track_click=e),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1},8,["label"]),(0,f.Wm)($,{span:12,label:(0,f.SU)(a)("market.task.edit.trackOpen"),path:"track_open"},{default:(0,f.w5)(()=>[(0,f.Wm)(eU,{value:(0,f.SU)(ed).track_open,"onUpdate:value":t[16]||(t[16]=e=>(0,f.SU)(ed).track_open=e),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1},8,["label"])]),_:1}),(0,f.Wm)(S,{label:e.$t("market.task.edit.threads"),"show-feedback":!1},{default:(0,f.w5)(()=>[(0,f.Wm)(ey,{value:(0,f.SU)(eo),"onUpdate:value":[t[17]||(t[17]=e=>(0,f.dq)(eo)?eo.value=e:null),ev]},{default:(0,f.w5)(()=>[(0,f.Wm)(eW,{value:0},{default:(0,f.w5)(()=>[(0,f.Uk)((0,f.zw)(e.$t("market.task.edit.threadsAuto")),1)]),_:1}),(0,f.Wm)(eW,{value:1},{default:(0,f.w5)(()=>[(0,f.Uk)((0,f.zw)(e.$t("market.task.edit.threadsCustom")),1)]),_:1})]),_:1},8,["value"]),(0,f.wy)((0,f._)("div",M,[(0,f.Wm)(ex,{value:(0,f.SU)(ed).threads,"onUpdate:value":t[18]||(t[18]=e=>(0,f.SU)(ed).threads=e),min:1,max:100,"show-button":!1},null,8,["value"])],512),[[f.F8,1===(0,f.SU)(eo)]])]),_:1},8,["label"])]),_:1}),(0,f.Wm)(ej,null,{default:(0,f.w5)(()=>[(0,f.Wm)(S,{label:(0,f.SU)(a)("market.task.edit.sendTime"),path:"start_time"},{default:(0,f.w5)(()=>[(0,f.Wm)(ey,{value:(0,f.SU)(em),"onUpdate:value":[t[20]||(t[20]=e=>(0,f.dq)(em)?em.value=e:null),eg],class:"flex items-center"},{default:(0,f.w5)(()=>[(0,f.Wm)(eW,{value:0},{default:(0,f.w5)(()=>[(0,f.Uk)((0,f.zw)((0,f.SU)(a)("market.task.edit.sendTimeNow")),1)]),_:1}),(0,f.Wm)(eW,{class:"items-center",value:1}),(0,f.Wm)(eZ,{value:(0,f.SU)(ed).start_time,"onUpdate:value":t[19]||(t[19]=e=>(0,f.SU)(ed).start_time=e),class:"ml-8px",type:"datetime",disabled:0===(0,f.SU)(em)},null,8,["value","disabled"])]),_:1},8,["value"])]),_:1},8,["label"]),(0,f.Wm)(S,{label:e.$t("market.task.edit.remark")},{default:(0,f.w5)(()=>[(0,f.Wm)(W,{value:(0,f.SU)(ed).remark,"onUpdate:value":t[21]||(t[21]=e=>(0,f.SU)(ed).remark=e),placeholder:e.$t("market.task.edit.remarkPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),(0,f.Wm)(S,{label:e.$t("market.task.edit.testEmail"),"show-feedback":!1},{default:(0,f.w5)(()=>[(0,f._)("div",E,[(0,f.Wm)(W,{value:(0,f.SU)(ep),"onUpdate:value":t[22]||(t[22]=e=>(0,f.dq)(ep)?ep.value=e:null),placeholder:e.$t("market.task.edit.testEmailPlaceholder")},null,8,["value","placeholder"])]),(0,f.Wm)(ei,{onClick:eb},{default:(0,f.w5)(()=>[(0,f.Uk)((0,f.zw)(e.$t("market.task.edit.sendTest")),1)]),_:1})]),_:1},8,["label"])]),_:1})],512)]),_:1},8,["model"]),(0,f._)("div",D,[(0,f.Wm)(ej,{class:"h-full","content-style":{display:"flex",flexDirection:"column",height:"100%"}},{default:(0,f.w5)(()=>[(0,f._)("div",I,[(0,f._)("div",A,[(0,f._)("div",L,(0,f.zw)((0,f.SU)(a)("market.task.edit.from"))+":",1),(0,f._)("div",Q,(0,f.zw)((0,f.SU)(ed).addresser),1)]),(0,f._)("div",K,[(0,f._)("div",Y,(0,f.zw)((0,f.SU)(a)("market.task.edit.to"))+":",1),(0,f._)("div",B,(0,f.zw)((0,f.SU)(en)||"--"),1)]),(0,f._)("div",F,[(0,f._)("div",G,(0,f.zw)((0,f.SU)(a)("market.task.edit.subject"))+":",1),(0,f._)("div",J,(0,f.zw)((0,f.SU)(ed).subject||"--"),1)])]),(0,f._)("div",V,[(0,f.SU)(ek)?((0,f.wg)(),(0,f.j4)(ez,{key:0,value:(0,f.SU)(ek)},null,8,["value"])):((0,f.wg)(),(0,f.iD)("div",X,(0,f.zw)((0,f.SU)(a)("market.task.edit.preview.empty")),1))])]),_:1})])],4)]),(0,f._)("div",ee,[(0,f.Wm)(ei,{type:"primary",onClick:eh},{default:(0,f.w5)(()=>[(0,f.Uk)((0,f.zw)(e.$t("common.actions.confirm")),1)]),_:1}),(0,f.Wm)(ei,{class:"ml-16px",secondary:"",onClick:ef},{default:(0,f.w5)(()=>[(0,f.Uk)((0,f.zw)(e.$t("common.actions.back")),1)]),_:1})])])}}}),et=(0,t(41748).default)(ea,[["__scopeId","data-v-1e63a0e0"]])}}]);